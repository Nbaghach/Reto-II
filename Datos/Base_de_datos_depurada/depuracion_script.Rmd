---
title: "Reto 1 modulo 8"
output: html_document
date: "2025-08-03"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

```{r}


setwd("C:\\Users\\nabee\\Desktop\\MASTER BEHAVIOURAL DATA SCIENCE\\MODULO VIII\\ddf--unpop--international_migrant_stock-master")

getwd()
```




```{r}
# 1. Paquetes
if (!requireNamespace("readr", quietly = TRUE)) install.packages("readr")
if (!requireNamespace("dplyr", quietly = TRUE)) install.packages("dplyr")
library(readr)
library(dplyr)

# 2. Directorio base del DDF en tu Windows
base <- "C:/Users/nabee/Desktop/MASTER BEHAVIOURAL DATA SCIENCE/MODULO VIII/ddf--unpop--international_migrant_stock-master/ddf--unpop--international_migrant_stock-master"

# 3. Verificar que los archivos existen
list.files(base, pattern = "ddf--entities--geo--country.csv", full.names = TRUE)
list.files(base, pattern = "ddf--datapoints--immigrant_stock--by--geo--year.csv", full.names = TRUE)
list.files(base, pattern = "ddf--datapoints--emigrant_stock--by--geo--year.csv", full.names = TRUE)

# 4. Cargar
entities_geo <- read_csv(file.path(base, "ddf--entities--geo--country.csv"))
immigrant_df <- read_csv(file.path(base, "ddf--datapoints--immigrant_stock--by--geo--year.csv"))
emigrant_df  <- read_csv(file.path(base, "ddf--datapoints--emigrant_stock--by--geo--year.csv"))

# 5. Preparar inm/emi y unir con nombres legibles
imm <- immigrant_df %>%
  left_join(entities_geo, by = c("geo" = "country")) %>%
  rename(country_name = name,
         immigrant_stock_value = immigrant_stock) %>%
  mutate(year = as.integer(year))

emi <- emigrant_df %>%
  left_join(entities_geo, by = c("geo" = "country")) %>%
  rename(country_name = name,
         emigrant_stock_value = emigrant_stock) %>%
  mutate(year = as.integer(year))

# 6. Guardar los CSV “tidy”
out_dir <- dirname(base)  # carpeta padre
write_csv(imm, file.path(out_dir, "immigrant_stock_by_country_year.csv"))
write_csv(emi, file.path(out_dir, "emigrant_stock_by_country_year.csv"))

# 7. Calcular migración neta (opcional)
net_mig <- full_join(imm, emi, by = c("geo", "year", "country_name")) %>%
  mutate(
    immigrant_stock_value = as.numeric(immigrant_stock_value),
    emigrant_stock_value  = as.numeric(emigrant_stock_value),
    net_migration = immigrant_stock_value - emigrant_stock_value
  )

write_csv(net_mig, file.path(out_dir, "migracion_neta_por_pais_ano.csv"))

# Mensaje final
message("CSV de inmigrantes y emigrantes creados en: ", out_dir)
message("También se generó migración neta en: ", file.path(out_dir, "migracion_neta_por_pais_ano.csv"))
```